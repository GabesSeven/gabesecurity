<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DACL / LDAP</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <header>
    <h1>Discretionary Access Control List (DACL) / Lista de Controle de PermissÃµes de Acesso (LPDA)</h1>
  </header>

   <div class="content">
    <h3>LDAP Overview</h3>
    <p>LDAP (Lightweight Directory Access Protocol) Ã© um protocolo para acessar e gerenciar serviÃ§os de diretÃ³rio, que armazenam informaÃ§Ãµes em uma estrutura hierÃ¡rquica chamada DIT (Directory Information Tree). Vantagens do LDAP:</p>
    <ul>
        <li>Baseado em TCP/IP</li>
        <li>Permite consultas entre diretÃ³rios</li>
        <li>API em C â†’ fÃ¡cil integraÃ§Ã£o</li>
        <li>Suporta Kerberos, SASL, SSL/TLS</li>
    </ul>

    <h3>Directory Servers</h3>
    <p>Um servidor de diretÃ³rio (Directory Server Agent - DSA) funciona como um banco de dados hierÃ¡rquico:</p>
    <ul>
        <li>Relacional â†’ tabelas (linhas e colunas)</li>
        <li>LDAP â†’ entradas em Ã¡rvore (DIT)</li>
    </ul>
    <pre>
dc=empresa,dc=com
â”œâ”€â”€ ou=Usuarios
â”‚   â”œâ”€â”€ cn=Joao
â”‚   â””â”€â”€ cn=Maria
â””â”€â”€ ou=Servidores
    â””â”€â”€ cn=FileServer01
    </pre>
    <p>Protocolos suportados: LDAP, X.500, DNS, NIS, DSML, SCIM, NDS</p>

    <h4>Nomenclaturas</h4>
    
    <ul>
        <li>UPN (User Principal Name) â†’ user@domain.com</li>
    </ul>

    <h3>Entradas</h3>
    <ul>
        <li><strong>DN (Distinguished Name)</strong> â€“ identifica unicamente a entrada</li>
        <li><strong>Atributos</strong> â€“ dados associados</li>
        <li><strong>Object Classes</strong> â€“ definem atributos obrigatÃ³rios/opcionais</li>
    </ul>

    <h3>DNs e RDNs</h3>

    <pre>
DN: uid=john.doe,ou=People,dc=example,dc=com

RDNs:
uid=john.doe
ou=People
dc=example
dc=com
    </pre>
    <p>Ordem do mais especÃ­fico para o mais geral.</p>
    <pre>
dc=com
 â””â”€â”€ dc=example
     â””â”€â”€ ou=People
         â””â”€â”€ uid=john.doe
    </pre>
    <p>Null DN ("") â†’ Root DSE, entrada especial do servidor.</p>

    <h3>LDAP Search Operation</h3>
    <h4>Base DN</h4>
    <p>Define onde a busca comeÃ§a no diretÃ³rio.</p>
    <pre>Base DN: DC=empresa,DC=com</pre>

    <h4>Escopos de busca</h4>
    <ul>
        <li><span class="highlight">baseObject (â€œbaseâ€)</span>: sÃ³ busca o prÃ³prio objeto</li>
        <li><span class="highlight">singleLevel (â€œoneâ€)</span>: busca apenas os filhos imediatos</li>
        <li><span class="highlight">wholeSubtree (â€œsubâ€)</span>: busca toda a subÃ¡rvore</li>
        <li><span class="highlight">subordinateSubtree (â€œsubordinatesâ€)</span>: como wholeSubtree, mas ignora o prÃ³prio objeto base</li>
    </ul>

    <h4>Alias Dereferencing</h4>
    <ul>
        <li>neverDerefAliases â†’ nunca segue alias</li>
        <li>derefInSearching â†’ segue apenas aliases encontrados na pesquisa</li>
        <li>derefFindingBaseObj â†’ sÃ³ segue se o objeto base for alias</li>
        <li>derefAlways â†’ sempre segue aliases</li>
    </ul>

    <h4>Limites da busca</h4>
    <ul>
        <li>Size Limit â†’ mÃ¡ximo de entradas retornadas (ex: <code>sizeLimit=1000</code>)</li>
        <li>Time Limit â†’ mÃ¡ximo de tempo em segundos (ex: <code>timeLimit=30</code>)</li>
    </ul>

    <h4>TypesOnly flag</h4>
    <ul>
        <li>true â†’ retorna somente nomes dos atributos</li>
        <li>false â†’ retorna atributos com valores</li>
    </ul>
    <pre>
TypesOnly = true:
dn: CN=Joao,OU=Usuarios,DC=empresa,DC=com
cn:
sn:
mail:

TypesOnly = false:
dn: CN=Joao,OU=Usuarios,DC=empresa,DC=com
cn: Joao
sn: Silva
mail: joao@empresa.com
    </pre>

    <h3>Filtros de pesquisa</h3>
    <p>Exemplo de filtro AND:</p>
    <pre>(&amp;(objectClass=user)(department=TI))</pre>
    <ul>
        <li>Presence â†’ (mail=*)</li>
        <li>Equality â†’ (uid=john.doe)</li>
        <li>Substring â†’ (cn=Jo*)</li>
        <li>>= / <= â†’ (age>=18)</li>
        <li>Approximate â†’ (cn~=Jon)</li>
        <li>Extensible â†’ filtros customizados</li>
    </ul>
    <p>Operadores lÃ³gicos:</p>
    <ul>
        <li>AND â†’ (&amp;(objectClass=user)(department=TI))</li>
        <li>OR â†’ (|(uid=john)(uid=maria))</li>
        <li>NOT â†’ (!(department=RH))</li>
    </ul>

    <h3>Atributos solicitados</h3>
    <ul>
        <li>"*" â†’ todos atributos de usuÃ¡rio</li>
        <li>"+" â†’ atributos operacionais</li>
        <li>"1.1" â†’ nenhum atributo</li>
        <li>"@inetOrgPerson" â†’ atributos de um objeto classe especÃ­fico</li>
    </ul>

    <h3>Modifications (Modify Operation)</h3>
    <ul>
        <li>add â†’ adiciona atributo/valores</li>
        <li>delete â†’ remove valores ou atributo inteiro</li>
        <li>replace â†’ substitui valores</li>
        <li>increment â†’ soma/subtrai valores numÃ©ricos</li>
    </ul>
    <pre>
dn: uid=john.doe,ou=People,dc=example,dc=com
changetype: modify
replace: mail
mail: john.new@example.com
    </pre>

    <h3>LDAP URLs</h3>
    <p>Representam todas as informaÃ§Ãµes necessÃ¡rias para buscar entradas:</p>
    <pre>ldap[s]://&lt;host&gt;:&lt;port&gt;/&lt;baseDN&gt;?&lt;attributes&gt;?&lt;scope&gt;?&lt;filter&gt;?&lt;extensions&gt;</pre>
    <ul>
        <li><strong>Scheme</strong> â†’ ldap:// ou ldaps:// (SSL/TLS)</li>
        <li><strong>Host/Port</strong> â†’ Servidor e porta (389 = LDAP, 636 = LDAPS)</li>
        <li><strong>Base DN</strong> â†’ onde a busca comeÃ§a</li>
        <li><strong>Attributes</strong> â†’ atributos a retornar</li>
        <li><strong>Scope</strong> â†’ base, one, sub</li>
        <li><strong>Filter</strong> â†’ filtro LDAP</li>
        <li><strong>Extensions</strong> â†’ opcionais</li>
    </ul>
    <pre>
ldap://ds.example.com:389/dc=example,dc=com?cn,sn,mail?sub?(uid=john.doe)

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Scheme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                   â”‚
ldap://ds.example.com:389/dc=example,dc=com?cn,sn,mail?sub?(uid=john.doe)
        â”‚          â”‚        â”‚      â”‚       â”‚
        â”‚          â”‚        â”‚      â”‚       â””â”€â”€ Filter: (uid=john.doe)
        â”‚          â”‚        â”‚      â””â”€â”€ Scope: sub (subÃ¡rvore)
        â”‚          â”‚        â””â”€â”€ Attributes: cn, sn, mail
        â”‚          â””â”€â”€ Base DN: dc=example,dc=com
        â””â”€â”€ Host: ds.example.com:389
    </pre>

    <h3>LDAP Schema</h3>
    <p>Define a estrutura e regras do DIT, semelhante a um banco de dados relacional:</p>
    <ul>
        <li>Tabelas â†’ Object Classes</li>
        <li>Colunas â†’ Attribute Types</li>
        <li>Tipos de dados â†’ Attribute Syntaxes</li>
        <li>RestriÃ§Ãµes â†’ Matching Rules</li>
    </ul>
    <h3>Principais elementos</h3>
    <ul>
        <li><strong>Attribute Syntaxes</strong> â†’ define tipo de dado</li>
        <li><strong>Matching Rules</strong> â†’ define como comparar valores</li>
        <li><strong>Attribute Types</strong> â†’ atributos vÃ¡lidos de um objeto</li>
        <li><strong>Object Classes</strong> â†’ coleÃ§Ã£o de atributos (MUST / MAY)</li>
    </ul>
    <h3>Elementos adicionais</h3>
    <ul>
        <li>Name Forms â†’ restringem atributos usados como RDN</li>
        <li>DIT Content Rules â†’ atributos obrigatÃ³rios/opcionais por tipo</li>
        <li>DIT Structure Rules â†’ relaÃ§Ãµes hierÃ¡rquicas</li>
        <li>Matching Rule Uses â†’ limita atributos para certas regras</li>
    </ul>
    <pre>
objectClass: person
  MUST: cn, sn
  MAY: telephoneNumber, userPassword

DIT:
dc=example,dc=com
â””â”€â”€ uid=john.doe
     â”œâ”€â”€ objectClass: person
     â”œâ”€â”€ cn: John Doe
     â”œâ”€â”€ sn: Doe
     â”œâ”€â”€ telephoneNumber: +55 11 99999-0000
     â””â”€â”€ userPassword: secret
    </pre>
    <p>Se faltar cn ou sn, a entrada nÃ£o Ã© vÃ¡lida! ğŸš«</p>

    <h3>Directory Service (DS)</h3>
    <p>RepositÃ³rio hierÃ¡rquico de objetos (usuÃ¡rios, computadores, impressoras, etc.)</p>
    <pre>
[ Directory Service ]
     â”œâ”€â”€ User: Alice â†’ email, senha, grupo
     â”œâ”€â”€ User: Bob   â†’ email, senha, grupo
     â””â”€â”€ Printer01   â†’ localizaÃ§Ã£o, status
    </pre>

    <h3>Domain Controller (DC)</h3>
    <p>Servidor com Active Directory Domain Services (AD DS) instalado. ResponsÃ¡vel por autenticaÃ§Ã£o, controle de permissÃµes e replicaÃ§Ã£o entre DCs.</p>
    <pre>
[UsuÃ¡rio â†’ login]
       |
   [Domain Controller]
       |
  Valida credenciais (Kerberos)
       |
   [Acesso permitido aos recursos]
    </pre>
</div>
</body>
</html>
